<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:jdbc="http://www.springframework.org/schema/jdbc"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc.xsd">

    <context:property-placeholder properties-ref="defaultProperties" />

    <jdbc:embedded-database id="testDataSource" type="H2">
        <jdbc:script location="classpath:sql/test-schema.sql"/>
    </jdbc:embedded-database>

    <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
        <constructor-arg name="dataSource" ref="testDataSource"/>
    </bean>


    <bean id="defaultProperties" class="org.springframework.beans.factory.config.PropertiesFactoryBean">
        <property name="properties">
            <props>
                <prop key="jdbc.driver">org.postgresql.Driver</prop>
                <prop key="jdbc.url">jdbc:postgresql://cloud69b.cerit-sc.cz/spregistration</prop>
                <prop key="jdbc.username">spreg</prop>
                <prop key="jdbc.password">spreg123</prop>
                <prop key="rpc.url">https://perun-dev.cesnet.cz/ba/rpc/</prop>
                <prop key="rpc.user">XYZ</prop>
                <prop key="rpc.password">XYZ</prop>
                <prop key="admins">62692,0,0</prop>
                <prop key="attr.idpAttribute.name">urn:perun:facility:attribute-def:def:proxyIdentifiers</prop>
                <prop key="attr.idpAttribute.value">XYZ</prop>
                <prop key="attr.testSp.name">urn:perun:facility:attribute-def:def:isTestSp</prop>
                <prop key="attr.showOnServicesList.name">urn:perun:facility:attribute-def:def:isTestSp</prop>
                <prop key="attr.facilityAdmins.name">urn:perun:facility:attribute-def:def:administratorContact</prop>
                <prop key="oidc.isEnabled">true</prop>
                <prop key="langs">en,cs</prop>
                <prop key="signingAuthorities">auth1@mail.not,auth2@mail.not</prop>
            </props>
        </property>
    </bean>

    <bean id="requestManager" class="cz.metacentrum.perun.spRegistration.persistence.managers.impl.RequestManagerImpl">
        <property name="appConfig" ref="appConfig" />
        <property name="jdbcTemplate" ref="jdbcTemplate"/>
    </bean>

    <bean id="appConfig" class="cz.metacentrum.perun.spRegistration.persistence.configs.AppConfig">
        <property name="admins" value="#{'${admins}'.split('\s*,\s*')}" />
        <property name="idpAttribute" value="${attr.idpAttribute.name}" />
        <property name="idpAttributeValue" value="${attr.idpAttribute.value}" />
        <property name="testSpAttribute" value="${attr.testSp.name}" />
        <property name="showOnServicesListAttribute" value="${attr.showOnServicesList.name}" />
        <property name="adminsAttr" value="${attr.facilityAdmins.name}" />
        <property name="oidcEnabled" value="${oidc.isEnabled}" />
        <property name="langs" value="#{'${langs}'.split('\s*,\s*')}" />
        <property name="signingAuthorities" value="#{'${signingAuthorities}'.split('\s*,\s*')}" />
    </bean>

</beans>